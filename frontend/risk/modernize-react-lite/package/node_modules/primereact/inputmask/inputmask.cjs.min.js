"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),r=require("primereact/api"),n=require("primereact/hooks"),t=require("primereact/inputtext"),u=require("primereact/utils"),a=require("primereact/componentbase");function c(e){if(e&&e.__esModule)return e;var r=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var t=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,t.get?t:{enumerable:!0,get:function(){return e[n]}})}})),r.default=e,Object.freeze(r)}var l=c(e);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)({}).hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},o.apply(null,arguments)}var i=a.ComponentBase.extend({defaultProps:{__TYPE:"InputMask",autoClear:!0,autoFocus:!1,className:null,disabled:!1,id:null,mask:null,maxLength:null,invalid:!1,variant:null,name:null,onBlur:null,onChange:null,onComplete:null,onFocus:null,placeholder:null,readOnly:!1,required:!1,size:null,slotChar:"_",style:null,tabIndex:null,tooltip:null,tooltipOptions:null,type:"text",unmask:!1,value:null,children:void 0},css:{classes:{root:function(e){var r=e.props,n=e.context;return u.classNames("p-inputmask",{"p-filled":r.filled,"p-invalid":r.invalid,"p-variant-filled":r.variant?"filled"===r.variant:n&&"filled"===n.inputStyle})}}}}),s=l.memo(l.forwardRef((function(e,a){var c=l.useContext(r.PrimeReactContext),s=i.getProps(e,c),f=l.useRef(null),v=l.useRef(null),d=l.useRef(0),p=l.useRef([]),m=l.useRef([]),g=l.useRef(0),h=l.useRef(null),b=l.useRef(!1),y=l.useRef(null),C=l.useRef(null),k=l.useRef(null),R=l.useRef(null),O=l.useRef(null),x=l.useRef(!1),E={props:s},D=i.setMetaData(E).cx,P=function(e,r){var n,t,u,a=f.current;return a&&a.offsetParent&&a===document.activeElement?("number"==typeof e?(t=e,u="number"==typeof r?r:t,a.setSelectionRange?a.setSelectionRange(t,u):a.createTextRange&&((n=a.createTextRange()).collapse(!0),n.moveEnd("character",u),n.moveStart("character",t),n.select())):a.setSelectionRange?(t=a.selectionStart,u=a.selectionEnd):document.selection&&document.selection.createRange&&(u=(t=0-(n=document.selection.createRange()).duplicate().moveStart("character",-1e5))+n.text.length),{begin:t,end:u}):null},j=function(){for(var e=v.current;e<=d.current;e++)if(p.current[e]&&m.current[e]===I(e))return!1;return!0},I=l.useCallback((function(e){return s.slotChar.charAt(e<s.slotChar.length?e:0)}),[s.slotChar]),M=function(){return s.unmask?B():f.current&&f.current.value},q=function(e){for(;++e<g.current&&!p.current[e];);return e},H=function(e){for(;--e>=0&&!p.current[e];);return e},S=function(e,r){var n,t;if(!(e<0)){for(n=e,t=q(r);n<g.current;n++)if(p.current[n]){if(!(t<g.current&&p.current[n].test(m.current[t])))break;m.current[n]=m.current[t],m.current[t]=I(t),t=q(t)}F(),P(Math.max(v.current,e))}},T=function(e){var r,n,t,u;for(r=e,n=I(e);r<g.current;r++)if(p.current[r]){if(t=q(r),u=m.current[r],m.current[r]=n,!(t<g.current&&p.current[t].test(u)))break;n=u}},_=function(e){var r=f.current.value,n=P();if(n){if(h.current.length&&h.current.length>r.length){for(z(!0);n.begin>0&&!p.current[n.begin-1];)n.begin--;if(0===n.begin)for(;n.begin<v.current&&!p.current[n.begin];)n.begin++;P(n.begin,n.begin)}else{for(z(!0);n.begin<g.current&&!p.current[n.begin];)n.begin++;P(n.begin,n.begin)}s.onComplete&&j()&&s.onComplete({originalEvent:e,value:M()}),K(e)}},w=function(e){if(b.current=!1,z(),K(e),L(),s.onBlur&&s.onBlur(e),f.current.value!==y.current){var r=document.createEvent("HTMLEvents");r.initEvent("change",!0,!1),f.current.dispatchEvent(r)}},A=function(e,r){var n;for(n=e;n<r&&n<g.current;n++)p.current[n]&&(m.current[n]=I(n))},F=function(){f.current&&(f.current.value=m.current.join(""))},z=function(e){C.current=!0;var r,n,t,u=f.current&&f.current.value,a=-1;for(r=0,t=0;r<g.current;r++)if(p.current[r]){for(m.current[r]=I(r);t++<u.length;)if(n=u.charAt(t-1),p.current[r].test(n)){m.current[r]=n,a=r;break}if(t>u.length){A(r+1,g.current);break}}else m.current[r]===u.charAt(t)&&t++,r<k.current&&(a=r);return e?F():a+1<k.current?s.autoClear||m.current.join("")===R.current?(f.current&&f.current.value&&(f.current.value=""),A(0,g.current)):F():(F(),f.current&&(f.current.value=f.current.value.substring(0,a+1))),k.current?r:v.current},N=function(e){if(!s.readOnly){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])){var r=z(!0);P(r)}K(e),s.onComplete&&j()&&s.onComplete({originalEvent:e,value:M()})}},B=l.useCallback((function(){for(var e=[],r=0;r<m.current.length;r++){var n=m.current[r];p.current[r]&&n!==I(r)&&e.push(n)}return e.join("")}),[I]),K=function(e){if(s.onChange){var r=s.unmask?B():e&&e.target.value;s.onChange({originalEvent:e,value:R.current!==r?r:"",stopPropagation:function(){e.stopPropagation()},preventDefault:function(){e.preventDefault()},target:{name:s.name,id:s.id,value:R.current!==r?r:""}})}},L=function(){f.current&&f.current.value&&f.current.value.length>0?u.DomHandler.addClass(f.current,"p-filled"):u.DomHandler.removeClass(f.current,"p-filled")},U=function(e){var r;return f.current&&(null==s.value?f.current.value="":(f.current.value=s.value,r=z(e),setTimeout((function(){if(f.current)return F(),z(e)}),10)),y.current=f.current.value),L(),r},Z=l.useCallback((function(){return s.unmask?s.value!==B():R.current!==f.current.value&&f.current.value!==s.value}),[s.unmask,s.value,B]),Y=function(){if(s.mask){p.current=[],k.current=s.mask.length,g.current=s.mask.length,v.current=null;var e={9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"};x.current=u.DomHandler.isChrome()&&u.DomHandler.isAndroid();for(var r=s.mask.split(""),n=0;n<r.length;n++){var t=r[n];"?"===t?(g.current--,k.current=n):e[t]?(p.current.push(new RegExp(e[t])),null===v.current&&(v.current=p.current.length-1),n<k.current&&(d.current=p.current.length-1)):p.current.push(null)}m.current=[];for(var a=0;a<r.length;a++){var c=r[a];"?"!==c&&m.current.push(e[c]?I(a):c)}R.current=m.current.join("")}};l.useImperativeHandle(a,(function(){return{props:s,focus:function(){return u.DomHandler.focus(f.current)},getElement:function(){return f.current}}})),l.useEffect((function(){u.ObjectUtils.combinedRefs(f,a)}),[f,a]),n.useMountEffect((function(){Y(),U()})),n.useUpdateEffect((function(){Y(),P(U(!0)),s.unmask&&K()}),[s.mask]),n.useUpdateEffect((function(){Z()&&U()}),[Z]);var G=i.getOtherProps(s),J=u.classNames(s.className,D("root",{context:c}));return l.createElement(t.InputText,o({ref:f,autoFocus:s.autoFocus,id:s.id,type:s.type,name:s.name,style:s.style,className:J,value:s.value},G,{placeholder:s.placeholder,size:s.size,maxLength:s.maxLength,tabIndex:s.tabIndex,disabled:s.disabled,invalid:s.invalid,readOnly:s.readOnly,onFocus:function(e){var r;s.readOnly||(b.current=!0,clearTimeout(O.current),y.current=f.current?f.current.value:"",r=z()||0,O.current=setTimeout((function(){f.current===document.activeElement&&(F(),r===s.mask.replace("?","").length?P(0,r):P(r),L())}),100),s.onFocus&&s.onFocus(e))},onBlur:w,onKeyDown:function(e){if(!s.readOnly){var r,n,t,a=e.which||e.keyCode;if(h.current=f.current.value,8===a||46===a||u.DomHandler.isIOS()&&127===a){if(!(r=P()))return;(t=r.end)-(n=r.begin)==0&&(n=46!==a?H(n):t=q(n-1),t=46===a?q(t):t),A(n,t),S(n,t-1),K(e),e.preventDefault()}else 13===a?(w(e),K(e)):27===a&&(f.current.value=y.current,P(0,z()),K(e),e.preventDefault())}},onKeyPress:function(e){if(!s.readOnly){var r=P();if(r){var n,t,a,c,l=e.which||e.keyCode;if(!(e.ctrlKey||e.altKey||e.metaKey||l<32)){if(l&&13!==l){if(r.end-r.begin!=0&&(A(r.begin,r.end),S(r.begin,r.end-1)),(n=q(r.begin-1))<g.current&&(t=String.fromCharCode(l),p.current[n].test(t))){if(T(n),m.current[n]=t,F(),a=q(n),u.DomHandler.isAndroid()){setTimeout((function(){P(a)}),0)}else P(a);r.begin<=d.current&&(c=j())}e.preventDefault()}K(e),s.onComplete&&c&&s.onComplete({originalEvent:e,value:M()})}}}},onInput:function(e){x.current?_(e):N(e)},onPaste:function(e){return N(e,!0)},required:s.required,tooltip:s.tooltip,tooltipOptions:s.tooltipOptions,pt:s.pt,unstyled:s.unstyled,__parentMetadata:{parent:E}}))})));s.displayName="InputMask",exports.InputMask=s;
